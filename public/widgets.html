<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Parent Window</title>
</head>

<body>

  <h1>Parent Window</h1>
  <p>Send Message: <button id="message_button">Hi there iframe</button></p>
  <p>Got Message:</p>
  <div id="results"></div>
  <br />

  <script>
    // addEventListener support for IE8
    function bindEvent(element, eventName, eventHandler) {
      if (element.addEventListener) {
        element.addEventListener(eventName, eventHandler, false);
      } else if (element.attachEvent) {
        element.attachEvent('on' + eventName, eventHandler);
      }
    }

    function createIframe(id, src) {
      var iframeSource = src;
      // Create the iframe
      var iframe = document.createElement('iframe');
      iframe.setAttribute('src', iframeSource);
      iframe.setAttribute('id', id);
      iframe.setAttribute('frameborder', 0);
      iframe.setAttribute('border', 0);
      iframe.setAttribute('cellspacing', 0);
      iframe.setAttribute('scrolling', 'no');
      iframe.style.width = '100%';
      iframe.style.height = '300px';
      document.body.appendChild(iframe);
      // Send a message to the child iframe
      var iframeEl = document.getElementById(id);
      return iframeEl;
    }
    
    var galaxyScore = createIframe('galaxy-score', 'http://localhost:3000/galaxy?stylesheet=http://localhost:5000/galaxy-score-widget.css');
    var news = createIframe('news', 'http://localhost:3000/news');

    var messageButton = document.getElementById('message_button');
    var results = document.getElementById('results');

    // Send a message to the child iframe
    var sendMessage = function (msg) {
      // Make sure you are sending a string, and to stringify JSON
      galaxyScore.contentWindow.postMessage(msg, '*');
      news.contentWindow.postMessage(msg, '*');
    };

    // Send random messge data on every button click
    bindEvent(messageButton, 'click', function (e) {
      var random = Math.random();
      sendMessage('' + random);
    });
    // Listen to message from child window
    bindEvent(window, 'message', function (e) {
      sendMessage('' + e.data);
      results.innerHTML = e.data;
    });
  </script>
</body>

</html>